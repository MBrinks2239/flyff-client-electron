<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Create Flyff Shortcut</title>
  <style>
    img#icon-preview {
      max-width: 64px;
      max-height: 64px;
      border: 1px solid #ccc;
      display: block;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>Create Flyff Profile Shortcut</h1>
  <form id="shortcut-form">
    <label>
      Profile Name:
      <input type="text" id="profile" required />
    </label><br><br>

    <label>
      Width:
      <input type="number" id="width" value="1920" />
    </label><br><br>

    <label>
      Height:
      <input type="number" id="height" value="1080" />
    </label><br><br>

    <label>
      Maximize Window on startup:
      <input type="checkbox" id="maximize" checked />
    </label><br><br>

    <label>
      Icon Folder / Color:
      <select id="folder-select"></select>
    </label><br><br>

    <label>
      Icon File / Class:
      <select id="icon-select"></select>
    </label><br><br>

    <img id="icon-preview" src="" alt="Icon preview" />

    <button type="submit">Create Shortcut</button>
  </form>

  <script>
    const { ipcRenderer } = require("electron");
    const fs = require("fs");
    const path = require("path");

    const assetsPath = path.join(__dirname, "..", "assets", "icons");
    const folderSelect = document.getElementById("folder-select");
    const iconSelect = document.getElementById("icon-select");
    const iconPreview = document.getElementById("icon-preview");

    // Populate folders
    const folders = fs.readdirSync(assetsPath).filter(file => {
      return fs.statSync(path.join(assetsPath, file)).isDirectory();
    });

    folders.forEach(folder => {
      const option = document.createElement("option");
      option.value = folder;
      option.textContent = folder;
      folderSelect.appendChild(option);
    });

    const loadIconsFromFolder = (folderName) => {
      const folderPath = path.join(assetsPath, folderName);
      const icons = fs.readdirSync(folderPath).filter(file => /\.(ico|png)$/i.test(file));
      
      iconSelect.innerHTML = "";
      icons.forEach(icon => {
        const option = document.createElement("option");
        option.value = icon;
        option.textContent = icon;
        iconSelect.appendChild(option);
      });

      if (icons.length > 0) {
        updatePreview(folderName, icons[0]);
      } else {
        iconPreview.src = "";
      }
    };

    const updatePreview = (folderName, iconName) => {
      const previewPath = path.join("..", "assets", "icons", folderName, iconName).replace(/\\/g, "/");
      iconPreview.src = previewPath;
    };

    folderSelect.addEventListener("change", () => {
      loadIconsFromFolder(folderSelect.value);
    });

    iconSelect.addEventListener("change", () => {
      updatePreview(folderSelect.value, iconSelect.value);
    });

    // Initial load
    if (folders.length > 0) {
      folderSelect.value = folders[0];
      loadIconsFromFolder(folders[0]);
    }

    document.getElementById("shortcut-form").addEventListener("submit", (e) => {
      e.preventDefault();
      const profile = document.getElementById("profile").value.trim();
      if (!profile) return alert("Please enter a profile name.");

      ipcRenderer.send("create-shortcut", {
        profile,
        width: parseInt(document.getElementById("width").value),
        height: parseInt(document.getElementById("height").value),
        noMaximize: !document.getElementById("maximize").checked,
        icon: path.join(folderSelect.value, iconSelect.value),
      });
    });

    ipcRenderer.on("shortcut-created", (event, result) => {
      if (result.success) {
        alert("Shortcut created successfully on your desktop!");
      } else {
        alert("Error creating shortcut: " + result.error);
      }
    });
  </script>
</body>
</html>
